// NavigationMenu.megadropdown.less
// v1.7
// Last Updated : 2012-06-18 16:10
// Copyright : SID Presse
// Author : Arnaud GAUDIN

//Config par défaut des widgets du template
@import "_templates/copilotesTheme/Widgets/_Widgets.less";

//OPTIMISATION : n'inclure que les utilitaires réellement utilisés dans ce widget (cf dossiers Utilities)
@import "_framework/SPLessCss/Utilities/Grids/_GridsUtils.less";
@import "_framework/SPLessCss/Utilities/Css3/_Css3Gradient.less";
@import "_framework/SPLessCss/Utilities/Css3/_Css3Shadow.less";
@import "_framework/SPLessCss/Utilities/Css3/_Css3Transform2D.less";
@import "_framework/SPLessCss/Utilities/Css3/_Css3Transition.less";

//Config du widget courant
@import "_templates/copilotesTheme/Widgets/NavigationMenu/_ConfigWidgetNavigationMenu.less";

//Importation des classes de composition du menu
@import "_framework/SPLessCss/Widgets/NavigationMenu/Megadropdown/_Megadropdown.less";

ul.menu-megadropdown {
	//rajout bordure à gauche sur le premier niveau
	& { border-left: 1px solid @menuBorderColor; }

	#dm_sidebar_left & {
		//largeur en fonction de la zone
		@gridWidth(@gridCol_SidebarLeft; 1px);
	}
	#dm_sidebar_right & {
		//largeur en fonction de la zone
		@gridWidth(@gridCol_SidebarRight; 1px);
	}

	//rajout bordure en haut sur les menus et gestion décalage
	#dm_sidebar_left &,
	#dm_sidebar_right & {
		//pour toutes les premières cellules
		& > li.first {
			& > .link { padding-top: @menuLinkPadV; border-top: 1px solid @menuBorderColor; }
			& > ul { top: 0; padding-top: (@gridBaseline -1px); }
		}
	}

	//Gestion de la couleurs des liens des dossiers
	ul li.dm_dir > .link,
	& > li.dm_dir > ul.hasDmDir > li > .link { color: @menuBgOpenColor; }

	//configuration des dimensions à différents sous-niveaux
	ul {
		background-color: @menuBgColor;
		//ajout bordure
		border: 1px solid @menuBorderColor;
		//changement de la pleine largeur au premier sous-niveau
		padding: @gridBaseline (@gridGutter -1px) (@gridBaseline -1px) (@gridGutter -1px);
		@gridWidth(@gridCol; (@gridGutter*2));

		//liens des sous niveaux
		li .link {
			//reset apparence du lien
			padding: 0;
			border: 0;
			//ajout d'un filet de séparation horizontal avec compensation décalage
			margin-top: -1px;

			//création d'une couleur intermédiaire avec la couleur de fond
			@interCouleur: mix(@menuBorderColor, @menuBgColor, 50%);
			border-top: 1px dotted @interCouleur;
			
			&, .rgba & { background-color: transparent; }

			//Couleur de rollOver des liens de sous-niveaux
			&:hover, &:focus { background-color: @menuBgHoverColor; }
		}
		
		//suppression bordure de séparation et marge négative
		&.hasDmDir > li > .link,
		li.first > .link,
		li.dm_dir > .link { margin-top: 0; border-top: 0; }

		#dm_sidebar_left & {
			//décalage manuel (largeur niveau supérieur ; décalage supérieur)
			@gridAbsoluteLeft(@gridCol_SidebarLeft; 2px);
			//pour aligner sur le lien d'ouverture (désactivé)
			// top: -1px;
			margin-top: 0;
			padding-top: (@gridBaseline -1px);
			padding-left: @gridGutter;
			ul {
				padding-top: 0;
				padding-left: 0;
			}
		}
		
		#dm_sidebar_right & {
			//décalage manuel (largeur niveau supérieur ; décalage supérieur)
			@gridAbsoluteRight(@gridCol_SidebarRight; 1px);
			//pour aligner sur le lien d'ouverture (désactivé)
			// top: -1px;
			margin-top: 0;
			padding-top: (@gridBaseline -1px);
			padding-right: @gridGutter;
			ul {
				padding-top: 0;
				padding-left: 0;
			}
		}
		
		//niveau 2 et +
		ul {
			padding: 0;
			left: 0;
			border: 0;
			&, .rgba & { background-color: transparent; }
		}
		
		//sous parties de niveau 2 et + contenues dans un ul contenant des sous-dossiers
		&.hasDmDir li {
			border-right: 1px dotted @menuBorderColor;
			padding: 0 (@gridGutter/2 -1px) 0 (@gridGutter/2);
			margin-bottom: @gridBaseline;
			//on suprimme les bordures et marges inférieures pour les sous parties
			li { border-right: 0; padding-right: @gridGutter/2; margin-bottom: 0; }
			
			//raccourcissement des zones extrêmes (sauf .last car pas forcément en fin de ligne) (firstOfRow, lastOfRow, inFirstRow et inLastRow ajoutés en JS)
			&.first, &.firstOfRow, &.lastOfRow {
				ul, & {
					//configuration par défaut avec la pleine largeur de la page
					@gridWidth(4; @gridGutter);
				}
			}

			//paramètres à adapter en fonction de la configuration de grille du template
			&.first, &.firstOfRow {
				ul, & {
					#dm_sidebar_left & {
						@gridWidth(5; @gridGutter);
					}
					#dm_sidebar_right & {
						@gridWidth(4; @gridGutter);
					}
				}
			}
			&.lastOfRow {
				ul, & {
					#dm_sidebar_left & {
						@gridWidth(5; @gridGutter);
					}
					#dm_sidebar_right & {
						@gridWidth(4; @gridGutter);
					}
				}
			}

			&.first, &.firstOfRow { padding-left: 0; }
			&.last, &.lastOfRow { border-right: 0; }
			&.last { padding-right: @gridGutter/2; }
			&.lastOfRow { padding-right: 0; }
			
			//suppression marge pour la dernière ligne
			&.inLastRow { margin-bottom: 0; }
			
			//niveau 3 et +
			ul li.dm_dir { padding-left: @gridGutter; padding-right: 0; }
		}

		//sous parties de niveau 2 et + contenues dans un ul ne contenant aucun sous-dossier
		&.hasNoDir li {
			//on prend la moitié de la largeur totale du site
			@gridWidth(floor(@gridCol/2); @gridGutter);
			//pour les sidebars on étale le contenu sur la moitié de la largeur restante
			#dm_sidebar_left & {
				@gridWidth(floor((@gridCol - @gridCol_SidebarLeft)/2); @gridGutter);
			}
			#dm_sidebar_right & {
				@gridWidth(floor((@gridCol - @gridCol_SidebarRight)/2); @gridGutter);
			}
		}
	}

	//couleur de la flèche
	& > li.dm_dir {
		& > .link:after {
			border-color: transparent transparent transparent @menuArrowColor;
			#dm_sidebar_right & { border-color: transparent @menuArrowColor transparent transparent; }
		}
		& > .link:hover:after,
		&:hover > .link:after {
			border-color: @menuArrowColorSup transparent transparent transparent;
			.csstransitions.csstransforms & { border-color: transparent transparent transparent @menuArrowColorSup; }
			.csstransitions.csstransforms #dm_sidebar_right & { border-color: transparent @menuArrowColorSup transparent transparent; }
		}
	}

	//Mise en page et themage personnalisé du menu de navigation dans la zone du header
	#dm_custom_top .dm_widget.navigation_menu & {
		//supression bordure à gauche sur le premier niveau
		border-left: 0;

		//ajout ombre et couleur de fond
		ul {
			background-color: @menuTopBgColor;
			// @boxShadow(@gridBaseline/8 @gridBaseline/8 @gridBaseline/8 fadeout(@colorBlack, 50%));
			//Copilotes : changement épaisseur ombrage
			@boxShadow(@offS @offS @offS @menuTopShadowColor);
			//suppression bordure du haut
			// border-top: 0;
			//Copilotes : on laisse la bordure en haut et on superpose
			margin-top: -1px;

			//niveau 2 et +
			ul {
				&, .rgba & { background-color: transparent; }
				@boxShadow(none);
				//Copilotes : réinitialisation placement
				margin-top: 0;
			}
			
			//liens des sous niveaux
			li .link {
				//ajout d'un filet de séparation horizontal avec compensation décalage
				margin-top: -1px;

				//création d'une couleur intermédiaire avec la couleur de fond
				@interCouleur: mix(@menuTopBorderColor, @menuTopBgColor, 50%);
				border-top: 1px dotted @interCouleur;
			}
			
			//suppression bordure de séparation et marge négative
			&.hasDmDir > li > .link,
			li.first > .link,
			li.dm_dir > .link { margin-top: 0; border-top: 0; }
		}

		//modification de couleurs du menu
		.link {
			//reset apparence du lien
			&, .rgba & { background-color: transparent; }
			padding: 0;
			border: 0;

			color: @menuTopLinkColor;
			&.dm_current { &, &:hover { color: @menuTopLinkCurrentColor; } }
			&.dm_inactive { color: @menuTopLinkInactiveColor; }
			//LoVe's Hurts Fade Away
			&:hover, &:focus { color: @menuTopLinkHoverColor; background-color: @menuTopBgHoverColor; }
			&:active { color: @menuTopLinkActiveColor; }
		}

		//gestion des cellules de premier niveau
		& > li {
			& > .link {
				//Co-pilotes : couleurs spécifiques
				background-color: transparent;
				color: @menuTopFirstLinkColor;
				border-color: transparent;
				margin-left: -1px;
				border-left-width: 1px;
				border-left-style: solid;
				border-right-width: 1px;
				border-right-style: solid;
				
				&:hover, &:focus { color: @menuTopFirstLinkHoverColor; background-color: @menuTopBgColor; }

				//uniformisation couleur de police
				&.dm_current { &, &:hover { color: @menuTopFirstLinkHoverColor; } }
				&.dm_inactive { color: @menuTopFirstLinkColor; }
				
				// margin-top: floor(@gridBaseline / 4) + 1px;
				// margin-bottom: floor(@gridBaseline / 4) + 1px;
				//ajout bordure à droite
				// border-right: 1px solid @menuBorderColor;

				//personnalisation padding pour menu horizontal
				// @padV: floor(@gridBaseline / 4) + 0px;
				@padH: @menuLinkPadHCustomTop;
				// padding: @padV @padH @padV (@padH +1px);

				//Co-pilotes : marges initiales
				margin-top: 0;
				margin-bottom: 0;
				padding: @gridBaseline/2 @padH @gridBaseline/2 (@padH +1px);
			}
			//pleine hauteur lors du rollOver
			&:hover > .link,
			& > .link:hover,
			& > .link:focus {
				// margin-top: 0;
				// margin-bottom: 0;
				// padding-top: @gridBaseline/2;
				// padding-bottom: @gridBaseline/2;
				// margin-left: -1px;
				// border-left: 1px solid @menuBorderColor;
				
				//Co-pilotes : couleurs spécifiques
				border-color: @menuBorderColor;
			}

			//rajout bordure à gauche sur la première cellule
			//et correction de la cellule suivant dm_root (qui contient une icône link_root)
			&.first,
			&.dm_root + li {
				//Co-pilotes : corrections de marge et couleur de bordure
				& > .link { margin-left: 0; }

				// & > .link { border-left: 1px solid @menuBorderColor; }
				//suppression décalage lors du rollOver
				// &:hover > .link,
				// & > .link:hover,
				// & > .link:focus { margin-left: 0; }
				
				//gestion décalage pour la première cellule
				ul {
					margin-left: 0;
					// ul { margin-left: -1px; }
				}
			}

			&.dm_dir {
				//masquage de la flèche
				& > .link:after {
					display: none;
					visibility: hidden;
					//suppression animation rotation
					@transformNone();
					@transitionNone();
				}

				//Copilotes : rajout d'une bordure en haut du lien pour fermer le contour du menu
				&:hover > .link,
				& > .link:hover,
				& > .link:focus {
					border-top: 1px solid @menuBorderColor;
					padding-top: (@gridBaseline/2 -1px);
					z-index: 600;
				}
			}
		}
	}
}