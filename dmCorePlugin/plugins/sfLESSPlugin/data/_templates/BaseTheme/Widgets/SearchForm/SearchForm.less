// _SearchForm.less
// v1.7
// Last Updated : 2012-07-11 10:30
// Copyright : SID Presse
// Author : Arnaud GAUDIN

//Config par défaut des widgets du template
@import "_templates/BaseTheme/Widgets/_Widgets.less";

//OPTIMISATION : n'inclure que les utilitaires réellement utilisés dans ce widget (cf dossiers Utilities)
@import "_framework/SPLessCss/Utilities/Css3/_Css3Border.less";
@import "_framework/SPLessCss/Utilities/Css3/_Css3Shadow.less";
@import "_framework/SPLessCss/Utilities/Css3/_Css3Transition.less";
@import "_framework/SPLessCss/Utilities/Grids/_GridsUtils.less";
@import "_framework/SPLessCss/Utilities/Sprites/_SpritesUtils.less";

//Importation de la mise en page par défaut du widget
@import "_framework/SPLessCss/Widgets/SearchForm/_SearchForm.less";

.dm_widget.search_form {
	.isLess & { background-color: fadeout(#BBF2F2, 25%); }

	//placement dans la zone située sous le header
	#dm_custom_top & {
		float: left;
		margin: 0 (@gridGutter - @zonesOffsetPad) 0 @zonesOffsetPad*-1;
	}

	.dm_widget_inner {
		.isLess & { background-color: fadeout(#8ED4D4, 75%); }

		//placement formulaire
		form {
			position: relative;
			background-color: @colorCouleur1;

			//application largeur (soustraction bordure)
			@gridWidth(@gridCol_SidebarLeft; (@zonesOffsetPad*-2));
			padding-bottom: @gridBaseline/2;

			//Ajout transition sur la couleur de fond
			.csstransitions & {
				@transitionCompress(background-color; .2s; ease-out; 0s);
			}

			//ajout de la sprite avec l'icône de recherche
			&:before {
				position: absolute;
				display: block;
				visibility: visible;
				z-index: 2;
				content: "";
				//décalage de marge
				@decalV: (@gridBaseline - @spriteFormat_S -2px)/2;
				// margin: @decalV 0 0 @offS;
				left: @offS;
				top: @decalV;
				//chargement sprite entière avec dimension et SVG
				@spriteDefinition(@widgetSearchFormSpriteSearchTheme; @widgetSearchFormSpriteSearchCategory; @widgetSearchFormSpriteSearchName; "S"; @spriteFormat_S; @widgetSearchFormSpriteSearchOffX; @widgetSearchFormSpriteSearchOffY);
				
				//animation apparition de la sprite
				.csstransitions.opacity & {
					opacity: 1;
					@transition(visibility, top, opacity; .05s, .2s, .2s; ease-out; .05s, .1s, .1s);
				}
			}

			//classe CSS focus ajoutée en JS
			&.focus {
				background-color: @colorCouleur1Moyen;
				&:before {
					//animation disparition de la sprite
					visibility: hidden;
					display: none;
					.csstransitions.opacity & {
						//on réaffiche la sprite pour gérer l'animation
						display: block;
						//replacement et disparition de la sprite
						// left: @spriteFormat_S*-1;
						top: @gridBaseline;
						opacity: 0;

						//changement délai
						@transitionDelay(.2s, .05s, .05s);
					}
				}
			}
		}

		//masquage du label et du bouton de validation
		.label, .submit { display: none; visibility: hidden; }
		
		//champ de saisie de la recherche
		.query {
			//ajout du padding-left et width au propriétés animées par défaut
			.csstransitions & {
				@transitionProperty(padding-left, width);
				@transitionDelay(0s);
				&:focus{
					@transitionDelay(.1s);
				}
			}

			//placement et stylage de l'élément
			display: block;
			z-index: 1;
			//changement couleur et transparence du fond
			&, &:focus, &:disabled { &, .rgba & { background-color: @colorWhite; } }
			//suppression outline parasite sous webkit
			outline: 0;
			border-color: @colorZoneBorder;

			//suppression des ombres internes
			.boxshadow & { &, &:focus, &:disabled { @boxShadowNone(); } }

			//application largeur
			&, .generatedcontent &:focus { @gridWidth(@gridCol_SidebarLeft; (@zonesOffsetPad*-2 + @offS*2 + 2px)); }

			//ajout du décalage à gauche si pseudo élément affiché
			.generatedcontent & {
				padding-left: @spriteFormat_S + @offS*2;
				@gridWidth(@gridCol_SidebarLeft; (@zonesOffsetPad*-2 + @offS*3 + @spriteFormat_S + 2px));

				//suppression padding left lors du focus
				&:focus { padding-left: @offS; }
			}

			//couleur des placeHolders
			//ciblage natif
			&::-webkit-input-placeholder { color: @colorText; }
			&:-moz-placeholder { color: @colorText; }
			//utilisé avec jQuery-placeholder
			&.placeholder { color: @colorText; }
		}
	}
}

//hack webkit (Safari et Chrome)
@media screen and (-webkit-min-device-pixel-ratio:0) {
	.dm_widget.search_form {
		.dm_widget_inner {
			//correction du bug sur le champ de saisi
			.query {
				//on enlève l'épaisseur de la bordure non prise en compte dans le calcul de la largeur
				&, .generatedcontent &:focus { @gridWidth(@gridCol_SidebarLeft; (@zonesOffsetPad*-2 + @offS*2 + 1px)); }
				.generatedcontent & { @gridWidth(@gridCol_SidebarLeft; (@zonesOffsetPad*-2 + @offS*3 + @spriteFormat_S + 1px)); }

				//suppression du délai car l'animation n'est pas gérée sur les pseudos éléments
				.csstransitions &:focus {
					@transitionDelay(0s);
				}
			}
		}
	}
}