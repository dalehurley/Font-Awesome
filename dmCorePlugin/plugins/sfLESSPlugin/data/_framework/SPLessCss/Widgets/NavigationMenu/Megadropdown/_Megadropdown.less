// _Megadropdown.less
// v1.5
// Last Updated : 2012-03-07 11:00
// Copyright : SID Presse
// Author : Arnaud GAUDIN

//OPTIMISATION : n'inclure que les utilitaires réellement utilisés dans ce widget (cf dossiers Utilities)
@import "_framework/SPLessCss/Utilities/Css3/_Css3Transition.less";

ul.megadropdown {

	//################################################
	//############ 0 AFFICHAGE DE DEBUG ##############
	//################################################

	//test affichage pour stylage
	// & > li:nth-child(6) {
	// & > li.last {
	// 	ul, ul ul { opacity: 1 !important; visibility: visible !important; }
	// }
	// .isLess & {
	// 	background-color: fadeout(#475F63, 50%);
	// 	li {
	// 		&:nth-of-type(odd) { background-color: fadeout(#6BC0D1, 50%); }
	// 		&:nth-of-type(even) { background-color: fadeout(#4E8D99, 50%); }
	// 		&.dm_dir > .link { background-color: fadeout(#ED2424, 50%) !important; }
	// 	}
	// 	ul { background-color: #2B3280 !important;
	// 		ul { background-color: fadeout(#2B3280, 50%) !important; }
	// 	}
	// 	.link { background-color: fadeout(#EDA724, 50%) !important; }
	// }

	//################################################
	//########### 1 CONFIGURATION DE BASE ############
	//################################################

	//Au cas où : suppression marges et listes à puce
	&, & ul, & li { list-style: none; margin: 0; padding: 0; }

	//gestion profondeur de placement
	position: relative;
	z-index: 597;
	float: left;

	//définitions de la taille de police par défaut
	font-size: @fontGlobalSize;
	line-height: @gridBaseline;
	vertical-align: middle;
	
	//gestion placement vertical
	//#dm_sidebar_left & { float: left; }
	//#dm_sidebar_right & { float: right; }
	
	//niveau 1 et +
	ul {
		position: absolute;
		z-index: 598;
		top: 100%;
		left: 0;
		//permet d'éviter les débordements de texte inopinés
		overflow: hidden;
		
		//gestion placement vertical
		#dm_sidebar_left &, #dm_sidebar_right & { top: 0; }
		//débuggage comportements opposés
		#dm_sidebar_left & { right: auto !important; }
		#dm_sidebar_right & { left: auto !important; }
		
		//niveau 2 et +
		ul {
			position: relative;
			top: 0;
			left: 0;
		}

		//suppression du float sur les li des sous-parties et sur les sous partie ne contenant pas de sous-dossiers
		&.hasNoDir li, li li { position: relative; float: none; }
	}

	//niveau 0
	li {
		float: left;
		line-height: @gridBaseline;
		vertical-align: middle;
		zoom: 1;

		&.hover, &:hover {
			z-index: 599;
			//cursor: default;
			left: 0;
		}

		//gestion placement vertical
		#dm_sidebar_left &, #dm_sidebar_right & {
			position: relative;
			float: none;
			& li.dm_dir { float: left; }
		}
		#dm_sidebar_left & { text-align: left; }
		#dm_sidebar_right & { text-align: right; }
	}

	//positionnement des liens (toujours ciblé par cette classe)
	.link { position: relative; display:block; width: auto; }

	//################################################
	//################# 2 DIMENSIONS #################
	//################################################

	//NIVEAU 0 : largeur automatique
	li { width: auto; }

	//NIVEAU 1 : pleine largeur
	ul {
		//affectation de la pleine largeur au premier sous-niveau
		@gridSiteWidth();
		
		//largeur du contenu pour le premier sous-niveau quand situé dans une sidebar
		#dm_sidebar_left &, #dm_sidebar_right & {
			//on rajoute la gouttière pour avoir une zone continue
			@gridWidth(@gridCol_Content; @gridGutter);
		}
		
		#dm_sidebar_left & {
			//décalage manuel (largeur niveau supérieur ; décalage supérieur)
			@gridAbsoluteLeft(@gridCol_SidebarLeft; 0);
			//décalage manuel (largeur niveau supérieur ; décalage supérieur)
			ul { left: 0; }
		}
		
		#dm_sidebar_right & {
			//décalage manuel (largeur niveau supérieur ; décalage supérieur)
			@gridAbsoluteRight(@gridCol_SidebarRight; 0);
			//décalage manuel (largeur niveau supérieur ; décalage supérieur)
			ul { right: 0; }
		}
		
		//définition largeur des sous parties
		&.hasNoDir li,
		&.hasDmDir li,
		ul, #dm_sidebar_left & ul, #dm_sidebar_right & ul {
			@gridWidth(4);
		}
		&.hasDmDir li ul li {
			&, &.first, &.firstOfRow, &.last, &.lastOfRow {
				@gridWidth(4);
			}
		}

		//pour tous les liens de niveau 1 lorsque des dossiers sont présents dans le ul
		&.hasDmDir li {
			//on rajoute le padding pour compenser la largeur manquante pour les gouttières
			padding: 0 @gridGutter/2;
			//suppression padding pour les sous-parties
			ul li {
				&, &.first, &.firstOfRow, &.last, &.lastOfRow { padding: 0; }
			}
		}

		//largeur auto pour les sous-dossiers de niveau 1 et +
		li li.dm_dir { width: auto; }
	}


	//################################################
	//################# 3 AFFICHAGE ##################
	//################################################
	
	//gestion de l'affichage direct du premier niveau
	& > li.dm_dir {
		& > ul { visibility: hidden; }
		&.hover > ul, &:hover > ul { visibility: visible; }
	}

	//ajout des transitions pour navigateurs récents
	.csstransitions.opacity & {
		//gestion de l'affichage direct du premier niveau
		& > li.dm_dir {
			& > ul {
				opacity: 0;
				//@transitionCompress(visibility, opacity; .2s; ease-out; .2s, 0);
				@transitionProperty(visibility, opacity);
				@transitionDuration(0, .2s);
				@transitionFunction(ease-out);
				@transitionDelay(.2s, 0);
			}
			&.hover > ul, &:hover > ul {
				opacity: 1;
				//@transitionCompress(visibility, opacity; .2s; ease-out; 0);
				@transitionDelay(0, 0);
			}
		}
	}
}